- if !commentaire.sent_by?(connected_user)
  .icon-avatar{ class: commentaire_class(commentaire, connected_user) }
    = icon

.width-100.fr-p-2w{ class: commentaire_class(commentaire, connected_user) }
  = tag.send(heading_level, class: 'fr-h6 fr-mb-1w') do
    %span.mail
      = commentaire_issuer
    - if commentaire_from_guest?
      %span.fr-text--xs.fr-text-mention--grey.font-weight-normal= t('.guest')
  - if badge = correction_badge
    .fr-mt-1v.fr-mb-1w
      = badge
  .rich-text
    - if commentaire.discarded?
      %p= "(#{t('.deleted_body')})"
    - elsif commentaire.sent_by_system?
      = sanitize(commentaire.body, scrubber: Sanitizers::MailScrubber.new)
    - else
      = render SimpleFormatComponent.new(commentaire.body, allow_a: false, allow_autolink: groupe_gestionnaire.nil? && commentaire.sent_by_instructeur?)

  - if soft_deletable?
    = button_to delete_url, method: :delete,  class: 'fr-btn fr-btn--sm fr-btn--tertiary fr-icon-delete-line fr-btn--icon-left fr-text-default--warning fr-mb-1w', form: { data: { turbo: true, turbo_confirm: t('.confirm') } } do
      = delete_button_text

  - if groupe_gestionnaire.nil? && commentaire.piece_jointe.attached?
    .fr-mt-2w
      - commentaire.piece_jointe.each do |attachment|
        = render Attachment::ShowComponent.new(attachment: attachment, new_tab: true)

  .fr-mt-1v.flex.align-center.flex-gap-1.justify-between
    %span.date{ class: ["fr-mb-0", "fr-text--xs", "fr-text-mention--grey", "font-weight-normal"], data: scroll_to_target }
      = commentaire_date
    - if sent_by_connected_user?
      - if read_by_recipient?
        .flex.align-center
          = dsfr_icon('fr-icon-check-line fr-icon--sm fr-mr-1w')
          %span.fr-text--xs.fr-text-mention--grey.font-weight-normal= t('.read_label')
      - else
        %span.fr-text--xs.fr-text-mention--grey.font-weight-normal.fr-mb-0= t('.unread_label')

- if commentaire.sent_by?(connected_user)
  .icon-avatar{ class: commentaire_class(commentaire, connected_user) }
    = icon
